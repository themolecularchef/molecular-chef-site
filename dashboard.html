<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="KiÅŸisel tarif listenizi yÃ¶netin. Favorilerinizi kaydedin, Ã¶zel listeler oluÅŸturun.">
    <title>Listelerim | Lezzet YolculuÄŸu</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ³</text></svg>">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDNH6hv0hbDYDcpQurTq0bDqtY87dhDzjo",
            authDomain: "membership-system-3efc1.firebaseapp.com",
            projectId: "membership-system-3efc1",
            storageBucket: "membership-system-3efc1.firebasestorage.app",
            messagingSenderId: "129656126432",
            appId: "1:129656126432:web:c4d5ad257f8eb96cd88985"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav" id="nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <span class="nav-logo-icon">ğŸ³</span>
                <span class="nav-logo-text">Lezzet YolculuÄŸu</span>
            </a>
            
            <div class="nav-links">
                <a href="index.html" class="nav-link">Tarifler</a>
                <a href="dashboard.html" class="nav-link active">Listelerim</a>
            </div>
            
            <div class="nav-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="KaranlÄ±k moda geÃ§">
                    <span class="theme-toggle-light">â˜€ï¸</span>
                    <span class="theme-toggle-dark">ğŸŒ™</span>
                </button>
                <div class="nav-user" id="navUser">
                    <span class="nav-user-name" id="navUserName"></span>
                    <button class="nav-logout" id="navLogout" title="Ã‡Ä±kÄ±ÅŸ yap">â†’</button>
                </div>
            </div>
            
            <button class="nav-mobile-toggle" id="navMobileToggle" aria-label="MenÃ¼yÃ¼ aÃ§">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html" class="mobile-link">Tarifler</a>
        <a href="dashboard.html" class="mobile-link active">Listelerim</a>
        <button class="mobile-logout" id="mobileLogout">Ã‡Ä±kÄ±ÅŸ Yap</button>
    </div>

    <!-- Main Content -->
    <main class="main main-dashboard" style="padding-top: calc(var(--nav-height) + var(--space-2xl));">
        <div class="container">
            <!-- Dashboard Header -->
            <div class="dashboard-header" style="margin-bottom: var(--space-2xl);">
                <h1 class="dashboard-title" style="font-family: var(--font-heading); font-size: clamp(1.75rem, 4vw, 2.5rem); font-weight: 600; margin-bottom: var(--space-sm);">
                    Merhaba, <span id="userName">Misafir</span> ğŸ‘‹
                </h1>
                <p class="dashboard-subtitle" style="font-size: 1rem; color: var(--color-text-secondary);">Favori tariflerinizi gÃ¶rÃ¼ntÃ¼leyin</p>
            </div>
            <!-- Create List Button -->
            <div style="margin-bottom: var(--space-xl);">
                <button id="createListBtn" class="btn btn-primary" style="display: flex; align-items: center; gap: var(--space-sm);">
                    <span>+</span> Yeni Liste OluÅŸtur
                </button>
            </div>

            <!-- Create List Modal -->
            <div class="modal" id="createListModal">
                <div class="modal-backdrop"></div>
                <div class="modal-content modal-sm">
                    <button class="modal-close" onclick="Modal.close('createListModal')">Ã—</button>
                    <div class="modal-header">
                        <h3 class="modal-title">Yeni Liste OluÅŸtur</h3>
                    </div>
                    <div class="modal-body">
                        <form id="createListForm">
                            <div class="form-group">
                                <label class="form-label" for="listName">Liste AdÄ±</label>
                                <input type="text" class="form-input" id="listName" placeholder="Ã–rn: Hafta Sonu MenÃ¼sÃ¼" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-full">OluÅŸtur</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Lists Section -->
            <div class="lists-section">
                <div class="lists-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xl);">
                    <h2 class="section-title" style="font-family: var(--font-heading); font-size: 1.5rem; font-weight: 600;">Listelerim</h2>
                </div>

                <!-- Lists Grid -->
                <div class="lists-grid" id="listsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--space-lg);">
                    <!-- Lists loaded dynamically -->
                </div>
                
                <!-- Empty State -->
                <div id="emptyLists" style="text-align: center; padding: var(--space-3xl); display: none;">
                    <div style="font-size: 4rem; margin-bottom: var(--space-lg); opacity: 0.5;">ğŸ“‹</div>
                    <h4 style="font-family: var(--font-heading); font-size: 1.5rem; margin-bottom: var(--space-sm);">HenÃ¼z listeniz yok</h4>
                    <p style="color: var(--color-text-secondary); margin-bottom: var(--space-lg);">Ä°lk listenizi oluÅŸturmak iÃ§in "Yeni Liste" butonuna tÄ±klayÄ±n.</p>
                </div>
            </div>
            <!-- Favorites Section -->
            <div class="lists-section">
                <div class="lists-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xl);">
                    <h2 class="section-title" style="font-family: var(--font-heading); font-size: 1.5rem; font-weight: 600;">Favorilerim</h2>
                </div>

                <!-- Favorites Grid -->
                <div class="lists-grid" id="favoritesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--space-lg);">
                    <!-- Favorites loaded dynamically -->
                </div>
                
                <!-- Empty State -->
                <div id="emptyFavorites" style="text-align: center; padding: var(--space-3xl); display: none;">
                    <div style="font-size: 4rem; margin-bottom: var(--space-lg); opacity: 0.5;">â¤ï¸</div>
                    <h4 style="font-family: var(--font-heading); font-size: 1.5rem; margin-bottom: var(--space-sm);">HenÃ¼z favori yok</h4>
                    <p style="color: var(--color-text-secondary); margin-bottom: var(--space-lg);">BeÄŸendiÄŸiniz tarifleri favorilere ekleyin.</p>
                    <a href="index.html" class="btn btn-primary btn-sm">Tariflere GÃ¶z At</a>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <span class="footer-logo">ğŸ³ Lezzet YolculuÄŸu</span>
                    <p class="footer-tagline">Evde profesyonel lezzetler</p>
                </div>
                <div class="footer-links">
                    <a href="index.html">Tarifler</a>
                    <a href="dashboard.html">Listelerim</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Lezzet YolculuÄŸu. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
       <script>
        // Modal fonksiyonlarÄ± (app.js'den baÄŸÄ±msÄ±z)
        const Modal = {
            open(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            },
            close(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }
        };

        // Toast fonksiyonu
        function showToast(message, type = 'default') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            if (toast && toastMessage) {
                toastMessage.textContent = message;
                toast.className = 'toast active ' + type;
                setTimeout(() => toast.classList.remove('active'), 3000);
            }
        }

        // Auth kontrolÃ¼ ve veri yÃ¼kleme
        firebase.auth().onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'index.html';
                return;
            }
            
            // KullanÄ±cÄ± bilgilerini gÃ¶ster
            document.getElementById('userName').textContent = user.displayName || user.email;
            document.getElementById('navUserName').textContent = user.displayName || user.email;
            
            // Listeleri ve favorileri yÃ¼kle
            await loadLists();
            await loadFavorites();
        });

        // Listeleri yÃ¼kle
        async function loadLists() {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                const doc = await db.collection('users').doc(user.uid).get();
                const lists = doc.exists ? (doc.data().lists || []) : [];
                
                const grid = document.getElementById('listsGrid');
                const emptyState = document.getElementById('emptyLists');
                
                if (lists.length === 0) {
                    grid.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                
                // Listeleri render et
                grid.innerHTML = lists.map(list => {
                    const recipeCount = list.recipes ? list.recipes.length : 0;
                    const recipeText = recipeCount === 0 ? 'HenÃ¼z tarif yok' : 
                                      recipeCount === 1 ? '1 tarif' : 
                                      `${recipeCount} tarif`;
                    
                    return `
                        <div class="list-card" style="background: var(--color-surface); border-radius: var(--radius-xl); overflow: hidden; box-shadow: var(--shadow-sm); cursor: pointer;" onclick="viewList('${list.id}')">
                            <div class="list-card-image" style="aspect-ratio: 16/10; background: var(--color-bg-secondary); display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                                ğŸ“‹
                            </div>
                            <div class="list-card-content" style="padding: var(--space-lg);">
                                <h3 style="font-family: var(--font-heading); font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-xs);">${list.name}</h3>
                                <p style="font-size: 0.875rem; color: var(--color-text-secondary);">${recipeText}</p>
                                <button onclick="event.stopPropagation(); deleteList('${list.id}')" class="btn btn-ghost btn-sm" style="margin-top: var(--space-md); color: var(--color-error);">Sil</button>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error("Listeler yÃ¼klenemedi:", error);
            }
        }

        // Yeni liste oluÅŸtur
        document.getElementById('createListBtn')?.addEventListener('click', () => {
            Modal.open('createListModal');
        });

        document.getElementById('createListForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const user = firebase.auth().currentUser;
            if (!user) {
                showToast('GiriÅŸ yapmalÄ±sÄ±nÄ±z', 'error');
                return;
            }
            
            const listName = document.getElementById('listName').value.trim();
            if (!listName) return;
            
            try {
                const userRef = db.collection('users').doc(user.uid);
                const doc = await userRef.get();
                
                const newList = {
                    id: Date.now().toString(),
                    name: listName,
                    recipes: [],
                    createdAt: new Date().toISOString()
                };
                
                if (doc.exists) {
                    const currentLists = doc.data().lists || [];
                    await userRef.update({
                        lists: [...currentLists, newList]
                    });
                } else {
                    await userRef.set({
                        lists: [newList]
                    });
                }
                
                showToast('Liste oluÅŸturuldu!', 'success');
                Modal.close('createListModal');
                document.getElementById('createListForm').reset();
                await loadLists();
                
            } catch (error) {
                console.error("Liste oluÅŸturulamadÄ±:", error);
                showToast('Liste oluÅŸturulamadÄ±', 'error');
            }
        });

        // Liste sil
        async function deleteList(listId) {
            if (!confirm('Bu listeyi silmek istediÄŸinize emin misiniz?')) return;
            
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                const userRef = db.collection('users').doc(user.uid);
                const doc = await userRef.get();
                
                if (doc.exists) {
                    const currentLists = doc.data().lists || [];
                    const updatedLists = currentLists.filter(l => l.id !== listId);
                    await userRef.update({ lists: updatedLists });
                    
                    showToast('Liste silindi');
                    await loadLists();
                }
            } catch (error) {
                console.error("Liste silinemedi:", error);
                showToast('Liste silinemedi', 'error');
            }
        }

        // Liste gÃ¶rÃ¼ntÃ¼le (basit alert, detaylÄ± modal eklenebilir)
        function viewList(listId) {
            // Buraya liste detay modalÄ± eklenebilir
            console.log('Liste gÃ¶rÃ¼ntÃ¼le:', listId);
        }

        // Favorileri yÃ¼kle (mevcut kodun gÃ¼ncellenmiÅŸ hali)
        async function loadFavorites() {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                const doc = await db.collection('users').doc(user.uid).get();
                const favorites = doc.exists ? (doc.data().favorites || []) : [];
                
                const grid = document.getElementById('favoritesGrid');
                const emptyState = document.getElementById('emptyFavorites');
                
                if (favorites.length === 0) {
                    grid.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                
                // Tarif verilerini Ã§ek
                if (window.Recipes && window.Recipes.data) {
                    grid.innerHTML = favorites.map(id => {
                        const recipe = window.Recipes.data.find(r => r.id === id);
                        if (!recipe) return '';
                        
                        return `
                            <div class="recipe-card" data-id="${recipe.id}">
                                <div class="recipe-card-image" style="position: relative; aspect-ratio: 4/3; overflow: hidden;">
                                    <img src="${recipe.image}" alt="${recipe.title}" style="width: 100%; height: 100%; object-fit: cover;">
                                    <div style="position: absolute; top: var(--space-md); right: var(--space-md);">
                                        <button onclick="removeFavorite('${recipe.id}')" style="width: 40px; height: 40px; border-radius: var(--radius-lg); background: rgba(255, 255, 255, 0.95); border: none; cursor: pointer; font-size: 1.125rem;">â¤ï¸</button>
                                    </div>
                                </div>
                                <div class="recipe-card-content" style="padding: var(--space-lg);">
                                    <span style="font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: var(--color-accent);">${recipe.category}</span>
                                    <h3 style="font-family: var(--font-heading); font-size: 1.25rem; margin: var(--space-xs) 0;">
                                        <a href="recipe.html?id=${recipe.id}">${recipe.title}</a>
                                    </h3>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    setTimeout(loadFavorites, 500);
                }
            } catch (error) {
                console.error("Favoriler yÃ¼klenemedi:", error);
            }
        }
        
        // Favoriden Ã§Ä±kar
        async function removeFavorite(recipeId) {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                await db.collection('users').doc(user.uid).update({
                    favorites: firebase.firestore.FieldValue.arrayRemove(recipeId)
                });
                
                showToast('Favorilerden Ã§Ä±karÄ±ldÄ±');
                loadFavorites();
            } catch (error) {
                console.error("Favori silinemedi:", error);
            }
        }
        
        // Ã‡Ä±kÄ±ÅŸ yap
        document.getElementById('navLogout').addEventListener('click', async () => {
            await firebase.auth().signOut();
            window.location.href = 'index.html';
        });
        
        document.getElementById('mobileLogout').addEventListener('click', async () => {
            await firebase.auth().signOut();
            window.location.href = 'index.html';
        });
    </script>
</body>
</html>
