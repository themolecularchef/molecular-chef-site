<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ki≈üisel tarif listenizi y√∂netin. Favorilerinizi kaydedin, √∂zel listeler olu≈üturun.">
    <title>Listelerim | Lezzet Yolculuƒüu</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç≥</text></svg>">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDNH6hv0hbDYDcpQurTq0bDqtY87dhDzjo",
            authDomain: "membership-system-3efc1.firebaseapp.com",
            projectId: "membership-system-3efc1",
            storageBucket: "membership-system-3efc1.firebasestorage.app",
            messagingSenderId: "129656126432",
            appId: "1:129656126432:web:c4d5ad257f8eb96cd88985"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav" id="nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <span class="nav-logo-icon">üç≥</span>
                <span class="nav-logo-text">Lezzet Yolculuƒüu</span>
            </a>
            
            <div class="nav-links">
                <a href="index.html" class="nav-link">Tarifler</a>
                <a href="dashboard.html" class="nav-link active">Listelerim</a>
            </div>
            
            <div class="nav-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="Karanlƒ±k moda ge√ß">
                    <span class="theme-toggle-light">‚òÄÔ∏è</span>
                    <span class="theme-toggle-dark">üåô</span>
                </button>
                <div class="nav-user" id="navUser">
                    <span class="nav-user-name" id="navUserName"></span>
                    <button class="nav-logout" id="navLogout" title="√áƒ±kƒ±≈ü yap">‚Üí</button>
                </div>
            </div>
            
            <button class="nav-mobile-toggle" id="navMobileToggle" aria-label="Men√ºy√º a√ß">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html" class="mobile-link">Tarifler</a>
        <a href="dashboard.html" class="mobile-link active">Listelerim</a>
        <button class="mobile-logout" id="mobileLogout">√áƒ±kƒ±≈ü Yap</button>
    </div>

    <!-- Main Content -->
    <main class="main main-dashboard" style="padding-top: calc(var(--nav-height) + var(--space-2xl));">
        <div class="container">
            <!-- Dashboard Header -->
            <div class="dashboard-header" style="margin-bottom: var(--space-2xl);">
                <h1 class="dashboard-title" style="font-family: var(--font-heading); font-size: clamp(1.75rem, 4vw, 2.5rem); font-weight: 600; margin-bottom: var(--space-sm);">
                    Merhaba, <span id="userName">Misafir</span> üëã
                </h1>
                <p class="dashboard-subtitle" style="font-size: 1rem; color: var(--color-text-secondary);">Favori tariflerinizi g√∂r√ºnt√ºleyin</p>
            </div>

            <!-- Favorites Section -->
            <div class="lists-section">
                <div class="lists-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xl);">
                    <h2 class="section-title" style="font-family: var(--font-heading); font-size: 1.5rem; font-weight: 600;">Favorilerim</h2>
                </div>

                <!-- Favorites Grid -->
                <div class="lists-grid" id="favoritesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--space-lg);">
                    <!-- Favorites loaded dynamically -->
                </div>
                
                <!-- Empty State -->
                <div id="emptyFavorites" style="text-align: center; padding: var(--space-3xl); display: none;">
                    <div style="font-size: 4rem; margin-bottom: var(--space-lg); opacity: 0.5;">‚ù§Ô∏è</div>
                    <h4 style="font-family: var(--font-heading); font-size: 1.5rem; margin-bottom: var(--space-sm);">Hen√ºz favori yok</h4>
                    <p style="color: var(--color-text-secondary); margin-bottom: var(--space-lg);">Beƒüendiƒüiniz tarifleri favorilere ekleyin.</p>
                    <a href="index.html" class="btn btn-primary btn-sm">Tariflere G√∂z At</a>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <span class="footer-logo">üç≥ Lezzet Yolculuƒüu</span>
                    <p class="footer-tagline">Evde profesyonel lezzetler</p>
                </div>
                <div class="footer-links">
                    <a href="index.html">Tarifler</a>
                    <a href="dashboard.html">Listelerim</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Lezzet Yolculuƒüu. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/firebase-auth.js"></script>
    <script src="js/firebase-lists.js"></script>
    <script src="js/recipes.js"></script>

    <script>
        // Auth kontrol√º ve veri y√ºkleme
        firebase.auth().onAuthStateChanged(async (user) => {
            if (!user) {
                // Giri≈ü yapƒ±lmamƒ±≈üsa ana sayfaya y√∂nlendir
                window.location.href = 'index.html';
                return;
            }
            
            // Kullanƒ±cƒ± bilgilerini g√∂ster
            document.getElementById('userName').textContent = user.displayName || user.email;
            document.getElementById('navUserName').textContent = user.displayName || user.email;
            
            // Favorileri y√ºkle
            await loadFavorites();
        });
        
        // Favorileri y√ºkle
        async function loadFavorites() {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                const doc = await db.collection('users').doc(user.uid).get();
                const favorites = doc.exists ? (doc.data().favorites || []) : [];
                
                const grid = document.getElementById('favoritesGrid');
                const emptyState = document.getElementById('emptyFavorites');
                
                if (favorites.length === 0) {
                    grid.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                
                // Tarif verilerini √ßek (recipes.js'den)
                if (window.Recipes && window.Recipes.data) {
                    grid.innerHTML = favorites.map(id => {
                        const recipe = window.Recipes.data.find(r => r.id === id);
                        if (!recipe) return '';
                        
                        return `
                            <div class="recipe-card" data-id="${recipe.id}">
                                <div class="recipe-card-image" style="position: relative; aspect-ratio: 4/3; overflow: hidden;">
                                    <img src="${recipe.image}" alt="${recipe.title}" style="width: 100%; height: 100%; object-fit: cover;">
                                    <div style="position: absolute; top: var(--space-md); right: var(--space-md);">
                                        <button onclick="removeFavorite('${recipe.id}')" style="width: 40px; height: 40px; border-radius: var(--radius-lg); background: rgba(255, 255, 255, 0.95); border: none; cursor: pointer; font-size: 1.125rem;">‚ù§Ô∏è</button>
                                    </div>
                                </div>
                                <div class="recipe-card-content" style="padding: var(--space-lg);">
                                    <span style="font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: var(--color-accent);">${recipe.category}</span>
                                    <h3 style="font-family: var(--font-heading); font-size: 1.25rem; margin: var(--space-xs) 0;">
                                        <a href="recipe.html?id=${recipe.id}">${recipe.title}</a>
                                    </h3>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    // Recipes verisi hen√ºz y√ºklenmemi≈üse bekle
                    setTimeout(loadFavorites, 500);
                }
            } catch (error) {
                console.error("Favoriler y√ºklenemedi:", error);
            }
        }
        
        // Favoriden √ßƒ±kar
        async function removeFavorite(recipeId) {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                await db.collection('users').doc(user.uid).update({
                    favorites: firebase.firestore.FieldValue.arrayRemove(recipeId)
                });
                
                showToast('Favorilerden √ßƒ±karƒ±ldƒ±');
                loadFavorites(); // Yeniden y√ºkle
            } catch (error) {
                console.error("Favori silinemedi:", error);
            }
        }
        
        // √áƒ±kƒ±≈ü yap
        document.getElementById('navLogout').addEventListener('click', async () => {
            await firebase.auth().signOut();
            window.location.href = 'index.html';
        });
        
        document.getElementById('mobileLogout').addEventListener('click', async () => {
            await firebase.auth().signOut();
            window.location.href = 'index.html';
        });
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.className = 'toast active';
            setTimeout(() => toast.classList.remove('active'), 3000);
        }
    </script>
</body>
</html>
