<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lezzetli yemek tarifleri, adƒ±m adƒ±m anlatƒ±mlar ve p√ºf noktalarƒ±. Evde profesyonel sonu√ßlar i√ßin tariflerimizi ke≈üfedin.">
    <title>Lezzet Yolculuƒüu | Yemek Tarifleri</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç≥</text></svg>">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
  // Yeni Proje Bilgileriniz
  const firebaseConfig = {
    apiKey: "AIzaSyDFl0YUuInv6JDr4A4n3DCBfhkcEBOmHYs",
    authDomain: "the-molecular-chef-17eb2.firebaseapp.com",
    projectId: "the-molecular-chef-17eb2",
    storageBucket: "the-molecular-chef-17eb2.firebasestorage.app",
    messagingSenderId: "23609596807",
    appId: "1:23609596807:web:18db592c11caeaade29122"
  };

  // Firebase'i Ba≈ülat
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
</head>
<body>
    <!-- Gƒ∞Rƒ∞≈û EKRANI (ƒ∞lk Ba≈ülangƒ±√ß) -->
    <div id="authScreen" style="position: fixed; inset: 0; z-index: 9999; background: linear-gradient(135deg, var(--color-bg) 0%, var(--color-bg-secondary) 100%); min-height: 100vh; display: none; flex-direction: column;">
        <!-- Navigation -->
        <nav class="nav nav-transparent">
            <div class="nav-container">
                <a href="#" class="nav-logo">
                    <span class="nav-logo-icon">üç≥</span>
                    <span class="nav-logo-text">Lezzet Yolculuƒüu</span>
                </a>
                <button class="theme-toggle" id="themeToggleAuth" aria-label="Karanlƒ±k moda ge√ß">
                    <span class="theme-toggle-light">‚òÄÔ∏è</span>
                    <span class="theme-toggle-dark">üåô</span>
                </button>
            </div>
        </nav>

        <!-- Auth Container -->
        <main style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2rem;">
            <div style="width: 100%; max-width: 420px; background: var(--color-surface); border-radius: 16px; padding: 2.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h1 id="authTitle" style="font-family: var(--font-heading); font-size: 1.75rem; font-weight: 600; margin-bottom: 0.5rem;">Giri≈ü Yap</h1>
                    <p id="authSubtitle" style="font-size: 0.9375rem; color: var(--color-text-secondary);">Hesabƒ±nƒ±za giri≈ü yaparak tariflerinizi kaydedin</p>
                </div>
                
                <form id="authForm" style="margin-bottom: 1.5rem;">
                    <div id="nameGroup" style="display: none; margin-bottom: 1.5rem;">
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">ƒ∞sim</label>
                        <input type="text" id="name" placeholder="ƒ∞sminizi girin" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: 8px; background: var(--color-bg);">
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">E-posta</label>
                        <input type="email" id="email" placeholder="ornek@email.com" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: 8px; background: var(--color-bg);">
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">≈ûifre</label>
                        <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: 8px; background: var(--color-bg);">
                    </div>
                    
                    <div id="confirmPasswordGroup" style="display: none; margin-bottom: 1.5rem;">
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">≈ûifre Tekrar</label>
                        <input type="password" id="confirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: 8px; background: var(--color-bg);">
                    </div>
                    
                    <button type="submit" id="authSubmit" style="width: 100%; padding: 0.75rem; background: var(--color-accent); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; font-size: 1rem;">Giri≈ü Yap</button>
                </form>
                
                <div style="display: flex; align-items: center; gap: 1rem; margin: 1.5rem 0; color: var(--color-text-muted); font-size: 0.875rem;">
                    <span style="flex: 1; height: 1px; background: var(--color-border);"></span>
                    <span>veya</span>
                    <span style="flex: 1; height: 1px; background: var(--color-border);"></span>
                </div>
                
                <button id="skipAuthBtn" style="width: 100%; padding: 0.75rem; background: transparent; border: 1px solid var(--color-border); border-radius: 8px; font-weight: 500; cursor: pointer; color: var(--color-text-secondary); margin-bottom: 1.5rem;">
                    √úye Olmadan Devam Et
                </button>
                
                <div style="text-align: center; font-size: 0.9375rem; color: var(--color-text-secondary);">
                    <span id="authToggleText">Hesabƒ±nƒ±z yok mu?</span>
                    <button id="authToggleBtn" style="background: none; border: none; color: var(--color-accent); font-weight: 500; cursor: pointer; margin-left: 0.25rem;">Kayƒ±t Ol</button>
                </div>
            </div>
        </main>
    </div>

    <!-- ANA WEB Sƒ∞TESƒ∞ -->
    <div id="mainWebsite" style="display: none;">
        <!-- Navigation -->
        <nav class="nav" id="nav">
            <div class="nav-container">
                <a href="index.html" class="nav-logo">
                    <span class="nav-logo-icon">üç≥</span>
                    <span class="nav-logo-text">Lezzet Yolculuƒüu</span>
                </a>
                
                <div class="nav-links">
                    <a href="index.html" class="nav-link active">Tarifler</a>
                    <a href="dashboard.html" class="nav-link nav-link-lists hidden" id="navLists">Listelerim</a>
                </div>
                
                <div class="nav-actions">
                    <button class="theme-toggle" id="themeToggle" aria-label="Karanlƒ±k moda ge√ß">
                        <span class="theme-toggle-light">‚òÄÔ∏è</span>
                        <span class="theme-toggle-dark">üåô</span>
                    </button>
                    <a href="#" onclick="showAuthScreen(); return false;" class="nav-auth" id="navAuth">Giri≈ü</a>
                    <div class="nav-user hidden" id="navUser">
                        <span class="nav-user-name" id="navUserName"></span>
                        <button class="nav-logout" id="navLogout" title="√áƒ±kƒ±≈ü yap">‚Üí</button>
                    </div>
                </div>
                
                <button class="nav-mobile-toggle" id="navMobileToggle" aria-label="Men√ºy√º a√ß">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <a href="index.html" class="mobile-link active">Tarifler</a>
            <a href="dashboard.html" class="mobile-link mobile-link-lists hidden" id="mobileLists">Listelerim</a>
            <a href="#" onclick="showAuthScreen(); return false;" class="mobile-link" id="mobileAuth">Giri≈ü</a>
            <div class="mobile-user hidden" id="mobileUser">
                <span class="mobile-user-name" id="mobileUserName"></span>
                <button class="mobile-logout" id="mobileLogout">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </div>

        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-bg">
                <img src="assets/images/iskender-kebap.webp" alt="Yemek arka plan" loading="eager">
                <div class="hero-overlay"></div>
            </div>
            <div class="hero-content">
                <h1 class="hero-title">Lezzetin Sƒ±rlarƒ±nƒ± Ke≈üfedin</h1>
                <p class="hero-subtitle">Evde profesyonel sonu√ßlar i√ßin √∂zenle hazƒ±rlanmƒ±≈ü tarifler</p>
                <div class="hero-search">
                    <input type="text" class="hero-search-input" id="searchInput" placeholder="Tarif ara...">
                    <button class="hero-search-btn" aria-label="Ara">üîç</button>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main">
            <div class="container">
                <!-- Filters -->
                <div class="filters">
                    <button class="filter-btn active" data-filter="all">T√ºm√º</button>
                    <button class="filter-btn" data-filter="Et Yemekleri">Et</button>
                    <button class="filter-btn" data-filter="Tavuk Yemekleri">Tavuk</button>
                    <button class="filter-btn" data-filter="Makarna">Makarna</button>
                    <button class="filter-btn" data-filter="√áorba">√áorba</button>
                    <button class="filter-btn" data-filter="Meze">Meze</button>
                </div>

                <!-- Recipes Grid -->
                <div class="recipes-grid" id="recipesGrid"></div>

                <!-- Empty State -->
                <div class="empty-state hidden" id="emptyState">
                    <div class="empty-state-icon">üîç</div>
                    <h3 class="empty-state-title">Sonu√ß bulunamadƒ±</h3>
                    <p class="empty-state-text">Aramanƒ±za uygun tarif bulamadƒ±k. Farklƒ± bir kelime deneyin.</p>
                </div>
            </div>
        </main>

        <!-- Quick View Modal -->
        <div class="modal" id="quickViewModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <button class="modal-close" aria-label="Kapat">√ó</button>
                <div class="modal-body" id="quickViewBody"></div>
            </div>
        </div>

        <!-- Listeye Ekle Modal (YENƒ∞) -->
        <div class="modal" id="addToListModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content modal-sm">
                <button class="modal-close" onclick="closeAddToListModal()" aria-label="Kapat">√ó</button>
                <div class="modal-header">
                    <h3 class="modal-title">Nereye kaydedeyim?</h3>
                    <p class="modal-subtitle" id="addToListRecipeName" style="font-size: 0.875rem; color: var(--color-text-secondary); margin-top: var(--space-xs);"></p>
                </div>
                <div class="modal-body">
                    <div id="addToListOptions" style="display: flex; flex-direction: column; gap: var(--space-md);">
                        <!-- Listeler buraya y√ºklenecek -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div class="toast" id="toast">
            <span class="toast-message" id="toastMessage"></span>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-brand">
                        <span class="footer-logo">üç≥ Lezzet Yolculuƒüu</span>
                        <p class="footer-tagline">Evde profesyonel lezzetler</p>
                    </div>
                    <div class="footer-links">
                        <a href="index.html">Tarifler</a>
                        <a href="#" onclick="showAuthScreen(); return false;">Giri≈ü</a>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 Lezzet Yolculuƒüu. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/firebase-auth.js"></script>
    <script src="js/firebase-lists.js"></script>
    <script src="js/recipes.js"></script>

    <!-- Main Logic -->
    <script>
        // Global deƒüi≈ükenler
        let currentRecipeForList = null;

        // Auth state ve UI kontrol√º
        firebase.auth().onAuthStateChanged((user) => {
            const authScreen = document.getElementById('authScreen');
            const mainWebsite = document.getElementById('mainWebsite');
            const navAuth = document.getElementById('navAuth');
            const navUser = document.getElementById('navUser');
            const navUserName = document.getElementById('navUserName');
            const navLists = document.getElementById('navLists');
            const mobileAuth = document.getElementById('mobileAuth');
            const mobileUser = document.getElementById('mobileUser');
            const mobileUserName = document.getElementById('mobileUserName');
            const mobileLists = document.getElementById('mobileLists');

            if (user) {
                authScreen.style.display = 'none';
                mainWebsite.style.display = 'block';
                document.body.style.overflow = 'auto';
                
                if (navAuth) navAuth.classList.add('hidden');
                if (navUser) navUser.classList.remove('hidden');
                if (navUserName) navUserName.textContent = user.displayName || user.email;
                if (navLists) navLists.classList.remove('hidden');
                
                if (mobileAuth) mobileAuth.classList.add('hidden');
                if (mobileUser) mobileUser.classList.remove('hidden');
                if (mobileUserName) mobileUserName.textContent = user.displayName || user.email;
                if (mobileLists) mobileLists.classList.remove('hidden');
            } else {
                const hasSkipped = localStorage.getItem('skipAuth');
                if (hasSkipped) {
                    authScreen.style.display = 'none';
                    mainWebsite.style.display = 'block';
                    document.body.style.overflow = 'auto';
                } else {
                    authScreen.style.display = 'flex';
                    mainWebsite.style.display = 'none';
                    document.body.style.overflow = 'hidden';
                }
                
                if (navAuth) navAuth.classList.remove('hidden');
                if (navUser) navUser.classList.add('hidden');
                if (navLists) navLists.classList.add('hidden');
                if (mobileAuth) mobileAuth.classList.remove('hidden');
                if (mobileUser) mobileUser.classList.add('hidden');
                if (mobileLists) mobileLists.classList.add('hidden');
            }
        });

        // Auth Screen Logic
        document.addEventListener('DOMContentLoaded', () => {
            const skipBtn = document.getElementById('skipAuthBtn');
            const toggleBtn = document.getElementById('authToggleBtn');
            const form = document.getElementById('authForm');
            
            if (skipBtn) {
                skipBtn.addEventListener('click', () => {
                    localStorage.setItem('skipAuth', 'true');
                    document.getElementById('authScreen').style.display = 'none';
                    document.getElementById('mainWebsite').style.display = 'block';
                    document.body.style.overflow = 'auto';
                });
            }
            
            let isLoginMode = true;
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    isLoginMode = !isLoginMode;
                    document.getElementById('authTitle').textContent = isLoginMode ? 'Giri≈ü Yap' : 'Kayƒ±t Ol';
                    document.getElementById('authSubtitle').textContent = isLoginMode ? 'Hesabƒ±nƒ±za giri≈ü yaparak tariflerinizi kaydedin' : 'Yeni bir hesap olu≈üturun';
                    document.getElementById('authSubmit').textContent = isLoginMode ? 'Giri≈ü Yap' : 'Kayƒ±t Ol';
                    document.getElementById('nameGroup').style.display = isLoginMode ? 'none' : 'block';
                    document.getElementById('confirmPasswordGroup').style.display = isLoginMode ? 'none' : 'block';
                    document.getElementById('authToggleText').textContent = isLoginMode ? 'Hesabƒ±nƒ±z yok mu?' : 'Zaten hesabƒ±nƒ±z var mƒ±?';
                    toggleBtn.textContent = isLoginMode ? 'Kayƒ±t Ol' : 'Giri≈ü Yap';
                });
            }
            
            if (form) {
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    
                    if (isLoginMode) {
                        try {
                            await firebase.auth().signInWithEmailAndPassword(email, password);
                        } catch (error) {
                            let msg = 'Giri≈ü yapƒ±lamadƒ±';
                            if (error.code === 'auth/user-not-found') msg = 'Kullanƒ±cƒ± bulunamadƒ±';
                            if (error.code === 'auth/wrong-password') msg = '≈ûifre hatalƒ±';
                            alert(msg);
                        }
                    } else {
                        const name = document.getElementById('name').value;
                        const confirmPass = document.getElementById('confirmPassword').value;
                        
                        if (!name.trim()) {
                            alert('L√ºtfen isminizi girin');
                            return;
                        }
                        
                        if (password !== confirmPass) {
                            alert('≈ûifreler e≈üle≈ümiyor');
                            return;
                        }
                        
                        if (password.length < 6) {
                            alert('≈ûifre en az 6 karakter olmalƒ±');
                            return;
                        }
                        
                        try {
                            const result = await firebase.auth().createUserWithEmailAndPassword(email, password);
                            await result.user.updateProfile({ displayName: name });
                            
                            await db.collection('users').doc(result.user.uid).set({
                                name: name,
                                email: email,
                                createdAt: new Date().toISOString(),
                                favorites: [],
                                lists: []
                            });
                        } catch (error) {
                            let msg = 'Kayƒ±t yapƒ±lamadƒ±';
                            if (error.code === 'auth/email-already-in-use') msg = 'Bu e-posta zaten kayƒ±tlƒ±';
                            if (error.code === 'auth/weak-password') msg = '≈ûifre √ßok zayƒ±f';
                            alert(msg);
                        }
                    }
                });
            }
            
            const navLogout = document.getElementById('navLogout');
            const mobileLogout = document.getElementById('mobileLogout');
            
            if (navLogout) {
                navLogout.addEventListener('click', async () => {
                    await firebase.auth().signOut();
                    localStorage.removeItem('skipAuth');
                    location.reload();
                });
            }
            
            if (mobileLogout) {
                mobileLogout.addEventListener('click', async () => {
                    await firebase.auth().signOut();
                    localStorage.removeItem('skipAuth');
                    location.reload();
                });
            }
        });

        function showAuthScreen() {
            localStorage.removeItem('skipAuth');
            location.reload();
        }

        // ============================
        // Lƒ∞STEYE EKLE MODAL FONKSƒ∞YONLARI
        // ============================

        // Listeye ekle modalƒ±nƒ± a√ß
        async function openAddToListModal(recipeId, recipeTitle) {
            const user = firebase.auth().currentUser;
            if (!user) {
                Toast.show('Listeye eklemek i√ßin giri≈ü yapmalƒ±sƒ±nƒ±z', 'error');
                setTimeout(() => {
                    window.location.href = 'auth.html';
                }, 1500);
                return;
            }

            currentRecipeForList = recipeId;
            document.getElementById('addToListRecipeName').textContent = recipeTitle;
            
            const modal = document.getElementById('addToListModal');
            const optionsContainer = document.getElementById('addToListOptions');
            
            // Kullanƒ±cƒ±nƒ±n listelerini √ßek
            try {
                const userRef = db.collection('users').doc(user.uid);
                const doc = await userRef.get();
                
                let html = '';
                
                // Favoriler se√ßeneƒüi (her zaman var)
                const favorites = doc.exists ? (doc.data().favorites || []) : [];
                const isInFavorites = favorites.includes(recipeId);
                
                html += `
                    <button onclick="addToFavorites('${recipeId}')" 
                            class="btn ${isInFavorites ? 'btn-secondary' : 'btn-primary'} btn-full" 
                            style="justify-content: flex-start; gap: var(--space-md); padding: var(--space-lg);">
                        <span style="font-size: 1.5rem;">‚ù§Ô∏è</span>
                        <div style="text-align: left;">
                            <div style="font-weight: 600;">Favorilerim</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">${isInFavorites ? 'Zaten favorilerde' : 'Favorilere ekle'}</div>
                        </div>
                    </button>
                `;
                
                // Kullanƒ±cƒ±nƒ±n diƒüer listeleri
                if (doc.exists) {
                    const lists = doc.data().lists || [];
                    
                    if (lists.length > 0) {
                        html += `<div style="border-top: 1px solid var(--color-border); padding-top: var(--space-md); margin-top: var(--space-sm);">
                            <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: var(--space-md);">Listelerim:</p>`;
                        
                        for (const list of lists) {
                            const isInList = list.recipes && list.recipes.includes(recipeId);
                            html += `
                                <button onclick="addToCustomList('${list.id}', '${recipeId}')" 
                                        class="btn ${isInList ? 'btn-secondary' : 'btn-ghost'} btn-full" 
                                        style="justify-content: flex-start; gap: var(--space-md); padding: var(--space-md); margin-bottom: var(--space-sm);">
                                    <span style="font-size: 1.25rem;">üìã</span>
                                    <div style="text-align: left; flex: 1;">
                                        <div style="font-weight: 500;">${list.name}</div>
                                        <div style="font-size: 0.8125rem; opacity: 0.7;">${list.recipes ? list.recipes.length : 0} tarif</div>
                                    </div>
                                    ${isInList ? '<span style="color: var(--color-accent);">‚úì</span>' : ''}
                                </button>
                            `;
                        }
                        
                        html += `</div>`;
                    }
                }
                
                // Yeni liste olu≈ütur butonu
                html += `
                    <button onclick="window.location.href='dashboard.html'" 
                            class="btn btn-ghost btn-full" 
                            style="justify-content: center; gap: var(--space-sm); padding: var(--space-md); margin-top: var(--space-sm); border-style: dashed;">
                        <span>+</span> Yeni Liste Olu≈ütur
                    </button>
                `;
                
                optionsContainer.innerHTML = html;
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
            } catch (error) {
                console.error("Listeler y√ºklenemedi:", error);
                Toast.show('Listeler y√ºklenemedi', 'error');
            }
        }

        // Modalƒ± kapat
        function closeAddToListModal() {
            const modal = document.getElementById('addToListModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
            currentRecipeForList = null;
        }

        // Favorilere ekle/√ßƒ±kar
        async function addToFavorites(recipeId) {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                const userRef = db.collection('users').doc(user.uid);
                const doc = await userRef.get();
                
                if (!doc.exists) {
                    await userRef.set({ favorites: [recipeId], lists: [] });
                    Toast.show('Favorilere eklendi!', 'success');
                } else {
                    const favorites = doc.data().favorites || [];
                    
                    if (favorites.includes(recipeId)) {
                        // Favorilerden √ßƒ±kar
                        await userRef.update({
                            favorites: firebase.firestore.FieldValue.arrayRemove(recipeId)
                        });
                        Toast.show('Favorilerden √ßƒ±karƒ±ldƒ±');
                    } else {
                        // Favorilere ekle
                        await userRef.update({
                            favorites: firebase.firestore.FieldValue.arrayUnion(recipeId)
                        });
                        Toast.show('Favorilere eklendi!', 'success');
                    }
                }
                
                // Modalƒ± yenile
                const recipe = window.Recipes ? window.Recipes.getRecipeById(recipeId) : null;
                openAddToListModal(recipeId, recipe ? recipe.title : '');
                
                // Kalp butonunu g√ºncelle
                updateFavoriteButtonUI(recipeId);
                
            } catch (error) {
                console.error("Favori hatasƒ±:", error);
                Toast.show('ƒ∞≈ülem yapƒ±lamadƒ±', 'error');
            }
        }

        // √ñzel listeye ekle/√ßƒ±kar
        async function addToCustomList(listId, recipeId) {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                const userRef = db.collection('users').doc(user.uid);
                const doc = await userRef.get();
                
                if (doc.exists) {
                    const lists = doc.data().lists || [];
                    const listIndex = lists.findIndex(l => l.id === listId);
                    
                    if (listIndex !== -1) {
                        const list = lists[listIndex];
                        const listRecipes = list.recipes || [];
                        
                        if (listRecipes.includes(recipeId)) {
                            // Listeden √ßƒ±kar
                            lists[listIndex].recipes = listRecipes.filter(id => id !== recipeId);
                            await userRef.update({ lists: lists });
                            Toast.show('Listeden √ßƒ±karƒ±ldƒ±');
                        } else {
                            // Listeye ekle
                            lists[listIndex].recipes = [...listRecipes, recipeId];
                            await userRef.update({ lists: lists });
                            Toast.show('Listeye eklendi!', 'success');
                        }
                        
                        // Modalƒ± yenile
                        const recipe = window.Recipes ? window.Recipes.getRecipeById(recipeId) : null;
                        openAddToListModal(recipeId, recipe ? recipe.title : '');
                    }
                }
            } catch (error) {
                console.error("Liste hatasƒ±:", error);
                Toast.show('ƒ∞≈ülem yapƒ±lamadƒ±', 'error');
            }
        }

        // Kalp butonu UI g√ºncelle
        function updateFavoriteButtonUI(recipeId) {
            const btn = document.querySelector(`.favorite-btn[data-id="${recipeId}"]`);
            if (btn) {
                firebase.auth().onAuthStateChanged(async (user) => {
                    if (user) {
                        const doc = await db.collection('users').doc(user.uid).get();
                        if (doc.exists) {
                            const favorites = doc.data().favorites || [];
                            const isFavorited = favorites.includes(recipeId);
                            
                            if (isFavorited) {
                                btn.classList.add('active');
                                btn.dataset.favorited = "true";
                                btn.querySelector('span').textContent = '‚ù§Ô∏è';
                                btn.title = 'Favorilerden √áƒ±kar';
                            } else {
                                btn.classList.remove('active');
                                btn.dataset.favorited = "false";
                                btn.querySelector('span').textContent = 'ü§ç';
                                btn.title = 'Favorilere Ekle';
                            }
                        }
                    }
                });
            }
        }

        // Backdrop tƒ±klama ile modal kapatma
        document.getElementById('addToListModal')?.querySelector('.modal-backdrop')?.addEventListener('click', closeAddToListModal);
    </script>
</body>
</html>
