<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lezzetli yemek tarifleri, adƒ±m adƒ±m anlatƒ±mlar ve p√ºf noktalarƒ±. Evde profesyonel sonu√ßlar i√ßin tariflerimizi ke≈üfedin.">
    <meta name="theme-color" content="#059669">
    <title>Lezzet Yolculuƒüu | Yemek Tarifleri</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">

    <link rel="icon" type="image/png" href="assets/images/Logo.png">

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCfWLSG4d7bamB-_3rDCeZFnM5Paq4GBO4",
            authDomain: "the-molecular-chef-17eb2.firebaseapp.com",
            projectId: "the-molecular-chef-17eb2",
            storageBucket: "the-molecular-chef-17eb2.firebasestorage.app",
            messagingSenderId: "23609596807",
            appId: "1:23609596807:web:18db592c11caeaade29122"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
</head>
<body>
    
    <!-- Main Website -->
        <nav class="nav" id="nav">
            <div class="nav-container">
                <a href="index.html" class="nav-logo">
                    <img src="assets/images/Logo.png" alt="Logo" style="height: 40px; width: auto;">
                    <span class="nav-logo-text">Lezzet Yolculuƒüu</span>
                </a>

                <div class="nav-links">
                    <a href="index.html" class="nav-link active">Tarifler</a>
                    <a href="dashboard.html" class="nav-link nav-link-lists hidden" id="navLists">Listelerim</a>
                </div>

                <div class="nav-actions">
                    <button class="theme-toggle" id="themeToggle" aria-label="Tema deƒüi≈ütir">
                        <span class="theme-toggle-light">‚òÄÔ∏è</span>
                        <span class="theme-toggle-dark">üåô</span>
                    </button>
                    <a href="#" onclick="showAuthScreen(); return false;" class="nav-auth" id="navAuth">Giri≈ü</a>
                    <div class="nav-user hidden" id="navUser">
                        <span class="nav-user-name" id="navUserName"></span>
                        <button class="nav-logout" id="navLogout" title="√áƒ±kƒ±≈ü yap">‚Üí</button>
                    </div>
                </div>

                <button class="nav-mobile-toggle" id="navMobileToggle" aria-label="Men√ºy√º a√ß">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>

        <div class="mobile-menu" id="mobileMenu">
            <a href="index.html" class="mobile-link active">Tarifler</a>
            <a href="dashboard.html" class="mobile-link mobile-link-lists hidden" id="mobileLists">Listelerim</a>
            <a href="#" onclick="showAuthScreen(); return false;" class="mobile-link" id="mobileAuth">Giri≈ü</a>
            <div class="mobile-user hidden" id="mobileUser">
                <span class="mobile-user-name" id="mobileUserName"></span>
                <button class="mobile-logout" id="mobileLogout">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </div>

        <section class="hero">
            <div class="hero-bg" id="heroSlider">
                <img src="assets/images/iskender-kebap.webp" class="slide active" alt="Tarif 1">
                <img src="assets/images/dovga-krutonlar.webp" class="slide" alt="Tarif 2">
                <img src="assets/images/elma-dilim-patates.webp" class="slide" alt="Tarif 3">
                <img src="assets/images/lavas-durum.webp" class="slide" alt="Tarif 4">
                <div class="hero-overlay"></div>
            </div>

            <div class="hero-content">
                <h1 class="hero-title">Lezzetin Sƒ±rlarƒ±nƒ± Ke≈üfedin</h1>
                <p class="hero-subtitle">Evde profesyonel sonu√ßlar i√ßin √∂zenle hazƒ±rlanmƒ±≈ü tarifler</p>
                <div class="hero-search">
                    <input type="text" class="hero-search-input" placeholder="Tarif ara..." id="heroSearchInput">
                    <button class="hero-search-btn" id="heroSearchBtn">üîç</button>
                </div>
            </div>
        </section>

        <main class="main">
            <div class="container">
                <div class="filters">
                    <button class="filter-btn active" data-filter="all">T√ºm√º</button>
                    <button class="filter-btn" data-filter="Et Yemekleri">Et</button>
                    <button class="filter-btn" data-filter="Tavuk Yemekleri">Tavuk</button>
                    <button class="filter-btn" data-filter="Makarna">Makarna</button>
                    <button class="filter-btn" data-filter="√áorba">√áorba</button>
                    <button class="filter-btn" data-filter="Meze">Meze</button>
                </div>

                <div class="recipes-grid" id="recipesGrid"></div>

                <div class="empty-state hidden" id="emptyState">
                    <div class="empty-state-icon">üîç</div>
                    <h3 class="empty-state-title">Sonu√ß bulunamadƒ±</h3>
                    <p class="empty-state-text">Aramanƒ±za uygun tarif bulamadƒ±k. Farklƒ± bir kelime deneyin.</p>
                </div>
            </div>
        </main>

        <div class="modal" id="quickViewModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <button class="modal-close" aria-label="Kapat">√ó</button>
                <div class="modal-body" id="quickViewBody"></div>
            </div>
        </div>

        <div class="modal" id="addToListModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content modal-sm">
                <button class="modal-close" onclick="closeAddToListModal()" aria-label="Kapat">√ó</button>
                <div class="modal-header">
                    <h3 class="modal-title">Nereye kaydedeyim?</h3>
                    <p class="modal-subtitle" id="addToListRecipeName" style="font-size: 0.875rem; color: var(--color-text-secondary); margin-top: var(--space-xs);"></p>
                </div>
                <div class="modal-body">
                    <div id="addToListOptions" style="display: flex; flex-direction: column; gap: var(--space-md);"></div>
                </div>
            </div>
        </div>

        <div class="toast" id="toast">
            <span class="toast-message" id="toastMessage"></span>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-brand">
                        <span class="footer-logo">
                            <img src="assets/images/Logo.png" style="height: 32px; width: auto; vertical-align: middle; margin-right: 8px;">
                            Lezzet Yolculuƒüu
                        </span>
                        <p class="footer-tagline">Evde profesyonel lezzetler</p>
                    </div>
                    <div class="footer-links">
                        <a href="index.html">Tarifler</a>
                        <a href="#" onclick="showAuthScreen(); return false;">Giri≈ü</a>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 Lezzet Yolculuƒüu. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
                </div>
            </div>
        </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/recipes.js"></script>

    <script>
        let currentRecipeForList = null;
        let isLoginMode = true;

                // Auth State Management
        firebase.auth().onAuthStateChanged((user) => {
            const navAuth = document.getElementById('navAuth');
            const navUser = document.getElementById('navUser');
            const navUserName = document.getElementById('navUserName');
            const navLists = document.getElementById('navLists');
            const mobileAuth = document.getElementById('mobileAuth');
            const mobileUser = document.getElementById('mobileUser');
            const mobileUserName = document.getElementById('mobileUserName');
            const mobileLists = document.getElementById('mobileLists');

            if (user) {
                // Giri≈ü yapmƒ±≈ü
                if (navAuth) navAuth.classList.add('hidden');
                if (navUser) {
                    navUser.classList.remove('hidden');
                    navUserName.textContent = user.displayName || user.email;
                }
                if (navLists) navLists.classList.remove('hidden');
                
                if (mobileAuth) mobileAuth.classList.add('hidden');
                if (mobileUser) {
                    mobileUser.classList.remove('hidden');
                    mobileUserName.textContent = user.displayName || user.email;
                }
                if (mobileLists) mobileLists.classList.remove('hidden');
                
                updateFavoriteButtons();
            } else {
                // Giri≈ü yapmamƒ±≈ü - ana sayfa g√∂ster
                if (navAuth) navAuth.classList.remove('hidden');
                if (navUser) navUser.classList.add('hidden');
                if (navLists) navLists.classList.add('hidden');
                
                if (mobileAuth) mobileAuth.classList.remove('hidden');
                if (mobileUser) mobileUser.classList.add('hidden');
                if (mobileLists) mobileLists.classList.add('hidden');
            }
        });
        
        // Auth Screen Logic
        document.addEventListener('DOMContentLoaded', () => {
            // Skip Auth
            document.getElementById('skipAuthBtn')?.addEventListener('click', () => {
                localStorage.setItem('skipAuth', 'true');
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainWebsite').style.display = 'block';
                document.body.style.overflow = 'auto';
            });

            // Toggle Login/Register
            document.getElementById('authToggleBtn')?.addEventListener('click', toggleAuthMode);

            // Auth Form Submit
            document.getElementById('authForm')?.addEventListener('submit', handleAuthSubmit);

            // Logout Buttons
            document.getElementById('navLogout')?.addEventListener('click', handleLogout);
            document.getElementById('mobileLogout')?.addEventListener('click', handleLogout);

            // Theme Toggle for Auth Screen
            document.getElementById('themeToggleAuth')?.addEventListener('click', () => {
                ThemeManager.toggle();
            });

            // Hero Slider
            initHeroSlider();
        });

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').textContent = isLoginMode ? 'Giri≈ü Yap' : 'Kayƒ±t Ol';
            document.getElementById('authSubtitle').textContent = isLoginMode ? 'Hesabƒ±nƒ±za giri≈ü yaparak tariflerinizi kaydedin' : 'Yeni bir hesap olu≈üturun';
            document.getElementById('authSubmit').textContent = isLoginMode ? 'Giri≈ü Yap' : 'Kayƒ±t Ol';
            document.getElementById('nameGroup').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('confirmPasswordGroup').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('authToggleText').textContent = isLoginMode ? 'Hesabƒ±nƒ±z yok mu?' : 'Zaten hesabƒ±nƒ±z var mƒ±?';
            document.getElementById('authToggleBtn').textContent = isLoginMode ? 'Kayƒ±t Ol' : 'Giri≈ü Yap';
        }

        async function handleAuthSubmit(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (isLoginMode) {
                try {
                    await firebase.auth().signInWithEmailAndPassword(email, password);
                    Toast.show('Giri≈ü ba≈üarƒ±lƒ±!', 'success');
                } catch (error) {
                    let msg = 'Giri≈ü yapƒ±lamadƒ±';
                    if (error.code === 'auth/user-not-found') msg = 'Kullanƒ±cƒ± bulunamadƒ±';
                    if (error.code === 'auth/wrong-password') msg = '≈ûifre hatalƒ±';
                    Toast.show(msg, 'error');
                }
            } else {
                const name = document.getElementById('name').value;
                const confirmPass = document.getElementById('confirmPassword').value;

                if (!name.trim()) {
                    Toast.show('L√ºtfen isminizi girin', 'error');
                    return;
                }
                if (password !== confirmPass) {
                    Toast.show('≈ûifreler e≈üle≈ümiyor', 'error');
                    return;
                }
                if (password.length < 6) {
                    Toast.show('≈ûifre en az 6 karakter olmalƒ±', 'error');
                    return;
                }

                try {
                    const result = await firebase.auth().createUserWithEmailAndPassword(email, password);
                    await result.user.updateProfile({ displayName: name });
                    await db.collection('users').doc(result.user.uid).set({
                        name: name,
                        email: email,
                        createdAt: new Date().toISOString(),
                        favorites: [],
                        lists: []
                    });
                    Toast.show('Kayƒ±t ba≈üarƒ±lƒ±!', 'success');
                } catch (error) {
                    let msg = 'Kayƒ±t yapƒ±lamadƒ±';
                    if (error.code === 'auth/email-already-in-use') msg = 'Bu e-posta zaten kayƒ±tlƒ±';
                    if (error.code === 'auth/weak-password') msg = '≈ûifre √ßok zayƒ±f';
                    Toast.show(msg, 'error');
                }
            }
        }

        async function handleLogout() {
            await firebase.auth().signOut();
            localStorage.removeItem('skipAuth');
            window.location.reload();
        }

        function showAuthScreen() {
            localStorage.removeItem('skipAuth');
            const authScreen = document.getElementById('authScreen');
            const mainWebsite = document.getElementById('mainWebsite');
            if (authScreen && mainWebsite) {
                authScreen.style.display = 'flex';
                mainWebsite.style.display = 'none';
                document.body.style.overflow = 'hidden';
            }
        }

        function initHeroSlider() {
            const slides = document.querySelectorAll('.hero-bg .slide');
            if (slides.length === 0) return;
            
            let currentSlide = 0;
            setInterval(() => {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }, 5000);
        }

        // Global function for recipes.js
        window.openAddToListModal = async function(recipeId, recipeTitle) {
            const user = firebase.auth().currentUser;
            if (!user) {
                Toast.show('Listeye eklemek i√ßin giri≈ü yapmalƒ±sƒ±nƒ±z', 'error');
                setTimeout(() => showAuthScreen(), 1500);
                return;
            }

            currentRecipeForList = recipeId;
            document.getElementById('addToListRecipeName').textContent = recipeTitle;

            const modal = document.getElementById('addToListModal');
            const optionsContainer = document.getElementById('addToListOptions');

            try {
                const userRef = db.collection('users').doc(user.uid);
                const doc = await userRef.get();

                let html = '';
                const favorites = doc.exists ? (doc.data().favorites || []) : [];
                const isInFavorites = favorites.includes(recipeId);

                html += `
                    <button onclick="addToFavorites('${recipeId}')" 
                            class="btn ${isInFavorites ? 'btn-secondary' : 'btn-primary'} btn-full" 
                            style="justify-content: flex-start; gap: var(--space-md); padding: var(--space-lg);">
                        <span style="font-size: 1.5rem;">‚ù§Ô∏è</span>
                        <div style="text-align: left;">
                            <div style="font-weight: 600;">Favorilerim</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">${isInFavorites ? 'Zaten favorilerde' : 'Favorilere ekle'}</div>
                        </div>
                    </button>
                `;

                if (doc.exists) {
                    const lists = doc.data().lists || [];
                    if (lists.length > 0) {
                        html += `<div style="border-top: 1px solid var(--color-border); padding-top: var(--space-md); margin-top: var(--space-sm);">
                            <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: var(--space-md);">Listelerim:</p>`;
                        for (const list of lists) {
                            const isInList = list.recipes && list.recipes.includes(recipeId);
                            html += `
                                <button onclick="addToCustomList('${list.id}', '${recipeId}')" 
                                        class="btn ${isInList ? 'btn-secondary' : 'btn-ghost'} btn-full" 
                                        style="justify-content: flex-start; gap: var(--space-md); padding: var(--space-md); margin-bottom: var(--space-sm);">
                                    <span style="font-size: 1.25rem;">üìã</span>
                                    <div style="text-align: left; flex: 1;">
                                        <div style="font-weight: 500;">${list.name}</div>
                                        <div style="font-size: 0.8125rem; opacity: 0.7;">${list.recipes ? list.recipes.length : 0} tarif</div>
                                    </div>
                                    ${isInList ? '<span style="color: var(--color-accent);">‚úì</span>' : ''}
                                </button>
                            `;
                        }
                        html += `</div>`;
                    }
                }

                html += `
                    <button onclick="window.location.href='dashboard.html'" 
                            class="btn btn-ghost btn-full" 
                            style="justify-content: center; gap: var(--space-sm); padding: var(--space-md); margin-top: var(--space-sm); border-style: dashed;">
                        <span>+</span> Yeni Liste Olu≈ütur
                    </button>
                `;

                optionsContainer.innerHTML = html;
                Modal.open('addToListModal');
            } catch (error) {
                console.error("Listeler y√ºklenemedi:", error);
                Toast.show('Listeler y√ºklenemedi', 'error');
            }
        };

        window.closeAddToListModal = function() {
            Modal.close('addToListModal');
            currentRecipeForList = null;
        };

        window.addToFavorites = async function(recipeId) {
            const user = firebase.auth().currentUser;
            if (!user) return;

            try {
                const userRef = db.collection('users').doc(user.uid);
                const doc = await userRef.get();

                if (!doc.exists) {
                    await userRef.set({ favorites: [recipeId], lists: [] });
                    Toast.show('Favorilere eklendi!', 'success');
                } else {
                    const favorites = doc.data().favorites || [];
                    if (favorites.includes(recipeId)) {
                        await userRef.update({
                            favorites: firebase.firestore.FieldValue.arrayRemove(recipeId)
                        });
                        Toast.show('Favorilerden √ßƒ±karƒ±ldƒ±');
                    } else {
                        await userRef.update({
                            favorites: firebase.firestore.FieldValue.arrayUnion(recipeId)
                        });
                        Toast.show('Favorilere eklendi!', 'success');
                    }
                }
                
                // Refresh modal if open
                if (currentRecipeForList) {
                    const recipe = window.Recipes ? window.Recipes.getRecipeById(recipeId) : null;
                    window.openAddToListModal(recipeId, recipe ? recipe.title : '');
                }
                updateFavoriteButtons();
            } catch (error) {
                console.error("Favori hatasƒ±:", error);
                Toast.show('ƒ∞≈ülem yapƒ±lamadƒ±', 'error');
            }
        };

        window.addToCustomList = async function(listId, recipeId) {
            const user = firebase.auth().currentUser;
            if (!user) return;

            try {
                const userRef = db.collection('users').doc(user.uid);
                const doc = await userRef.get();

                if (doc.exists) {
                    const lists = doc.data().lists || [];
                    const listIndex = lists.findIndex(l => l.id === listId);
                    if (listIndex !== -1) {
                        const list = lists[listIndex];
                        const listRecipes = list.recipes || [];
                        if (listRecipes.includes(recipeId)) {
                            lists[listIndex].recipes = listRecipes.filter(id => id !== recipeId);
                            await userRef.update({ lists: lists });
                            Toast.show('Listeden √ßƒ±karƒ±ldƒ±');
                        } else {
                            lists[listIndex].recipes = [...listRecipes, recipeId];
                            await userRef.update({ lists: lists });
                            Toast.show('Listeye eklendi!', 'success');
                        }
                        const recipe = window.Recipes ? window.Recipes.getRecipeById(recipeId) : null;
                        window.openAddToListModal(recipeId, recipe ? recipe.title : '');
                    }
                }
            } catch (error) {
                console.error("Liste hatasƒ±:", error);
                Toast.show('ƒ∞≈ülem yapƒ±lamadƒ±', 'error');
            }
        };

        async function updateFavoriteButtons() {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                const doc = await db.collection('users').doc(user.uid).get();
                if (!doc.exists) return;
                
                const favorites = doc.data().favorites || [];
                document.querySelectorAll('.favorite-btn').forEach(btn => {
                    const recipeId = btn.dataset.id;
                    if (favorites.includes(recipeId)) {
                        btn.classList.add('active');
                        btn.querySelector('span').textContent = '‚ù§Ô∏è';
                    } else {
                        btn.classList.remove('active');
                        btn.querySelector('span').textContent = 'ü§ç';
                    }
                });
            } catch (e) {
                console.error("Favori butonlarƒ± g√ºncellenemedi:", e);
            }
        }
    </script>
</body>
</html>
